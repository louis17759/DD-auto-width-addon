(()=>{"use strict";function e(){try{const e=DingdocsScript.base.getActiveSheet();if(!e)throw new Error("\u672a\u627e\u5230\u6fc0\u6d3b\u7684\u6570\u636e\u8868");return{id:e.getId(),name:e.getName(),desc:e.getDesc()||"",fieldsCount:e.getFields().length}}catch(e){throw new Error("\u83b7\u53d6\u6fc0\u6d3b\u6570\u636e\u8868\u5931\u8d25: ".concat(e.message))}}function t(){try{const e=DingdocsScript.base;return e.getSheets().map(e=>({id:e.getId(),name:e.getName(),desc:e.getDesc()||"",fieldsCount:e.getFields().length}))}catch(e){throw new Error("\u83b7\u53d6\u6570\u636e\u8868\u5217\u8868\u5931\u8d25: ".concat(e.message))}}function r(e){try{if(!e||""===e.trim())throw new Error("\u6570\u636e\u8868\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");const t=DingdocsScript.base.insertSheet(e.trim(),[{name:"\u6807\u9898",type:"text"},{name:"\u72b6\u6001",type:"singleSelect"},{name:"\u521b\u5efa\u65f6\u95f4",type:"date"}]);return{id:t.getId(),name:t.getName(),desc:t.getDesc()||"",fieldsCount:t.getFields().length}}catch(t){throw new Error("\u521b\u5efa\u6570\u636e\u8868\u5931\u8d25: ".concat(t.message))}}function c(e){try{if(!e)throw new Error("\u6570\u636e\u8868ID\u4e0d\u80fd\u4e3a\u7a7a");console.log("sheetId",e);return DingdocsScript.base.deleteSheet(e),{success:!0}}catch(t){throw new Error("\u5220\u9664\u6570\u636e\u8868\u5931\u8d25: ".concat(t.message))}}function i(e){try{const t=DingdocsScript.base;let r;if(r=e?t.getSheet(e):t.getActiveSheet(),!r)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");return r.getFields().map(e=>{var t;return{id:e.getId(),name:e.getName(),type:e.getType(),isPrimary:(null===(t=e.isPrimary)||void 0===t?void 0:t.call(e))||!1}})}catch(t){throw new Error("\u83b7\u53d6\u5b57\u6bb5\u4fe1\u606f\u5931\u8d25: ".concat(t.message))}}function s(e,t,r){try{var c;if(!e||""===e.trim())throw new Error("\u5b57\u6bb5\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");const i=DingdocsScript.base;let s;if(s=r?i.getSheet(r):i.getActiveSheet(),!s)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");const n=s.insertField({name:e.trim(),type:t});return{id:n.getId(),name:n.getName(),type:n.getType(),isPrimary:(null===(c=n.isPrimary)||void 0===c?void 0:c.call(n))||!1}}catch(i){throw new Error("\u6dfb\u52a0\u5b57\u6bb5\u5931\u8d25: ".concat(i.message))}}function n(e,t){try{var r;if(!e)throw new Error("\u5b57\u6bb5ID\u4e0d\u80fd\u4e3a\u7a7a");const c=DingdocsScript.base;let i;if(i=t?c.getSheet(t):c.getActiveSheet(),!i)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");const s=i.getField(e);if(s&&null!==(r=s.isPrimary)&&void 0!==r&&r.call(s))throw new Error("\u4e0d\u80fd\u5220\u9664\u4e3b\u952e\u5b57\u6bb5");return i.deleteField(e),{success:!0}}catch(c){throw new Error("\u5220\u9664\u5b57\u6bb5\u5931\u8d25: ".concat(c.message))}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{const r=DingdocsScript.base;let c;if(c=e?r.getSheet(e):r.getActiveSheet(),!c)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");const i=await c.getRecordsAsync({pageSize:t});return{records:i.records.map(e=>({id:e.getId(),fields:e.getCellValues()})),hasMore:i.hasMore,cursor:i.cursor,total:i.records.length}}catch(r){throw new Error("\u83b7\u53d6\u8bb0\u5f55\u5931\u8d25: ".concat(r.message))}}async function g(e,t){try{const r=DingdocsScript.base;let c;if(c=t?r.getSheet(t):r.getActiveSheet(),!c)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");const i=(await c.insertRecordsAsync([{fields:e}]))[0];return{id:i.getId(),fields:i.getCellValues()}}catch(r){throw new Error("\u6dfb\u52a0\u8bb0\u5f55\u5931\u8d25: ".concat(r.message))}}async function d(e,t,r){try{if(!e)throw new Error("\u8bb0\u5f55ID\u4e0d\u80fd\u4e3a\u7a7a");const c=DingdocsScript.base;let i;if(i=r?c.getSheet(r):c.getActiveSheet(),!i)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");const s=(await i.updateRecordsAsync([{id:e,fields:t}]))[0];return{id:s.getId(),fields:s.getCellValues()}}catch(c){throw new Error("\u66f4\u65b0\u8bb0\u5f55\u5931\u8d25: ".concat(c.message))}}async function a(e,t){try{if(!e)throw new Error("\u8bb0\u5f55ID\u4e0d\u80fd\u4e3a\u7a7a");const r=DingdocsScript.base;let c;if(c=t?r.getSheet(t):r.getActiveSheet(),!c)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");return await c.deleteRecordsAsync(e),{success:!0}}catch(r){throw new Error("\u5220\u9664\u8bb0\u5f55\u5931\u8d25: ".concat(r.message))}}function l(){try{var e;const t=DingdocsScript.base,r=t.getDentryUuid();return{uuid:r,sheetsCount:t.getSheets().length,currentSheet:(null===(e=t.getActiveSheet())||void 0===e?void 0:e.getName())||"\u65e0"}}catch(t){throw new Error("\u83b7\u53d6\u6587\u6863\u4fe1\u606f\u5931\u8d25: ".concat(t.message))}}DingdocsScript.registerScript("getActiveSheet",e),DingdocsScript.registerScript("getAllSheets",t),DingdocsScript.registerScript("createSheet",r),DingdocsScript.registerScript("deleteSheet",c),DingdocsScript.registerScript("getSheetFields",i),DingdocsScript.registerScript("addField",s),DingdocsScript.registerScript("deleteField",n),DingdocsScript.registerScript("getRecords",o),DingdocsScript.registerScript("addRecord",g),DingdocsScript.registerScript("updateRecord",d),DingdocsScript.registerScript("deleteRecord",a),DingdocsScript.registerScript("getDocumentInfo",l),DingdocsScript.registerScript("getActiveSheet",e),DingdocsScript.registerScript("getAllSheets",t),DingdocsScript.registerScript("createSheet",r),DingdocsScript.registerScript("deleteSheet",c),DingdocsScript.registerScript("getSheetFields",i),DingdocsScript.registerScript("addField",s),DingdocsScript.registerScript("deleteField",n),DingdocsScript.registerScript("getRecords",o),DingdocsScript.registerScript("addRecord",g),DingdocsScript.registerScript("updateRecord",d),DingdocsScript.registerScript("deleteRecord",a),DingdocsScript.registerScript("getDocumentInfo",l),DingdocsScript.registerScript("adjustColumnWidthByContent",async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",t=arguments.length>1?arguments[1]:void 0;try{const r=DingdocsScript.base;let c=[];if("allSheets"===e)c=r.getSheets();else{const e=t?r.getSheet(t):r.getActiveSheet();if(!e)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");c=[e]}let i=0;for(const t of c){const r=t.getViews(),c="current"===e?[r.find(e=>"Grid"===e.getType())].filter(Boolean):r.filter(e=>"Grid"===e.getType());if(0===c.length)continue;const s=await t.getRecordsAsync({pageSize:100}),n=t.getFields();for(const e of c){const t=e.asGridView();for(const e of n){const r=e.getId();let c=14*e.getName().length+40;for(const e of s.records){const t=e.getCellValue(r);if(null!==t&&void 0!==t){let e=0;e="string"===typeof t?t.length:"object"===typeof t&&t.text?t.text.length:String(t).length;const r=14*e+40;c=Math.max(c,r)}}c=Math.max(100,Math.min(500,c)),t.setFieldWidth(r,c)}i++}}return{success:!0,viewsCount:i,sheetsCount:c.length}}catch(r){throw new Error("\u8c03\u6574\u5217\u5bbd\u5931\u8d25: ".concat(r.message))}}),DingdocsScript.registerScript("adjustColumnWidthByHeader",function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",t=arguments.length>1?arguments[1]:void 0;try{const r=DingdocsScript.base;let c=[];if("allSheets"===e)c=r.getSheets();else{const e=t?r.getSheet(t):r.getActiveSheet();if(!e)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");c=[e]}let i=0;for(const t of c){const r=t.getViews(),c="current"===e?[r.find(e=>"Grid"===e.getType())].filter(Boolean):r.filter(e=>"Grid"===e.getType());if(0===c.length)continue;const s=t.getFields();for(const e of c){const t=e.asGridView();for(const e of s){const r=e.getId();let c=14*e.getName().length+40;c=Math.max(100,Math.min(400,c)),t.setFieldWidth(r,c)}i++}}return{success:!0,viewsCount:i,sheetsCount:c.length}}catch(r){throw new Error("\u8c03\u6574\u5217\u5bbd\u5931\u8d25: ".concat(r.message))}}),DingdocsScript.registerScript("adjustColumnWidthByFixedValue",function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"current",r=arguments.length>2?arguments[2]:void 0;try{if(!e||e<100||e>1e3)throw new Error("\u5217\u5bbd\u5fc5\u987b\u5728 100-1000 \u50cf\u7d20\u4e4b\u95f4");const c=DingdocsScript.base;let i=[];if("allSheets"===t)i=c.getSheets();else{const e=r?c.getSheet(r):c.getActiveSheet();if(!e)throw new Error("\u672a\u627e\u5230\u6307\u5b9a\u7684\u6570\u636e\u8868");i=[e]}let s=0;for(const r of i){const c=r.getViews(),i="current"===t?[c.find(e=>"Grid"===e.getType())].filter(Boolean):c.filter(e=>"Grid"===e.getType());if(0===i.length)continue;const n=r.getFields();for(const t of i){const r=t.asGridView();for(const t of n){const c=t.getId();r.setFieldWidth(c,e)}s++}}return{success:!0,viewsCount:s,sheetsCount:i.length}}catch(c){throw new Error("\u8c03\u6574\u5217\u5bbd\u5931\u8d25: ".concat(c.message))}})})();
//# sourceMappingURL=script.code.js.map